# golfish

## 概要

今までのコードゴルフ大会で大抵 GolfScript や gs2 より ><> (Fish) や Alice のような2次元言語のほうがコード長が短かったことから、2つを組み合わせようとしたゴルフ用の言語です。 ><> の仕様をもとにしつつ、 gs2 のようなバイナリ方式を採用しています。将来的には gs2 のようにいい感じの命令を揃えたいです。

## 仕様

改行にあたるのは 0x80 です。

入出力・文字列の非ASCIIでの動作は未定義です。

x y ... などと出てきたら、右側が top 側です。

### クラス

- Fixnum
- String
- Array
- Regexp

`true` は `1` 、 `false` は `0` になります。

演算によって `nil` が出てくることもありますが `nil` に関する動作は未定義です。

### 入出力

|コード|内容|
|-|-|
|00|何もしない|
|01|標準入力から1文字読み込み文字コードの整数を push|
|02|標準入力から空白があるまで読み込み、文字列を数値として解釈し push|
|03|標準入力をすべて読み込み、バイト列を Array として push|
|04|標準入力をすべて読み込み、文字列を空白区切りで数値の Array として解釈し push|
|05|pop し、 Fixnum の Array ならバイト列として文字列に変換し出力。 String ならそのまま出力。 Fixnum なら文字コードとして文字に変換し出力。|
|06|pop し、そのまま ruby の print|
|07|空白（0x20）を出力|
|08|改行（0x0a）を出力|

### 演算１

各項のクラスは問わない。

|コード|内容|
|-|-|
|10|`x + y`|
|11|`x - y`|
|12|`x * y`|
|13|`x / y`|
|14|`x % y`|
|15|`x ** y`|
|16|`~x`|
|17|`x & y`|
|18|`x | y`|
|19|`x ^ y`|
|1a|`x << y`|
|1b|`x >> y`|
|1c|`x[y]`|

### 演算２

真偽値は `1` か `0` に変換されることに注意。

|コード|内容|
|-|-|
|20|`x == y`|
|21|`x != y`|
|22|`x < y`|
|23|`x <= y`|
|24|`x > y`|
|25|`x >= y`|
|26|`x <=> y`|
|27|`x =~ y`|

### 列

0x30 から始まるバイト列は終端文字によって以下のように解釈される。

|コード|内容|
|-|-|
|f0|エスケープ（後続バイトは解釈せず突っ込む）|
|f1|整数配列終端|
|f2|文字列終端|
|f3|正規表現終端|
|f4|文字列終端・出力|

### 変換

|コード|内容|
|-|-|
|31|`to_i`|
|32|`to_s`|

### レジスタ

|コード|内容|
|-|-|
|ax (a0..af)|pop して x 番目のレジスタに代入|
|bx (b0..bf)|x 番目のレジスタの中身（初期値 `0`）を push|

### スタック操作

|コード|内容|
|-|-|
|c0|top を複製して push|
|c1|pop|
|c2|x y を　y x に|
|c3|x y z を　z x y に|
|c4|x y z を　y z x に|
|c5|stack を右に rotate|
|c6|stack を左に rotate|
|c7|stack を reverse|
|c8|stack の長さを push|
|c9|スタックトップにある Array から pop し stack に push|
|ca|スタックトップにある Array から pop し、新たな配列の要素として、その配列を stack に push|
|cb|廃止予定（0x10 と被るため）|
|cc|pop し、その下にあった配列に push|
|cd|空の配列を push|


## 数値

|コード|内容|
|-|-|
|dx (d0..da)|整数 x を push|
|db|`100` を push|
|dc|`1000` を push|
|dd|`16` を push|
|de|`64` を push|
|df|`256` を push|

## フロー制御

|コード|内容|
|-|-|
|e0|右へ（→）|
|e1|左へ（←）|
|e2|下へ（↓）|
|e3|上へ（↑）|
|e4|反射（／）|
|e5|反射（＼）|
|e6|上下のみ反射（ー）|
|e7|左右のみ反射（｜）|
|e8|時計回り90°|
|e9|反時計回り90°|
|ea|180°|
|eb|ランダム回転|
|ec|次の命令を飛ばす|
|ed|pop して 空配列/空文字/`0` なら次の命令を飛ばす|
|ec|2つ pop して (x, y) に飛ぶ（次に実行されるのはその隣の命令であることに注意）|
|ff|プログラム終了|
